#DEBUG
HABILITAR_DEBUG=SI
PATH_TMP_DIR=/tmp/
PDF_USA_PLANTILLAS=S
PDF_POS_X=4
PDF_POS_Y=60

#Libro de boletas
DB_SELECT_TOTAL_BOLETA_PERIODO=SELECT XD.indicador_servicio, count(*), SUM(DE.mntneto_dte), SUM(DE.iva_dte), SUM(DE.mont_tot_dte), SUM(DE.mnt_exen_dte) FROM xmldte XD, dte_enc DE WHERE XD.codi_empr=DE.codi_empr AND XD.tipo_docu=DE.tipo_docu AND XD.folio_dte=DE.folio_dte AND DE.fec_emi_dte LIKE ? AND XD.codi_empr=? AND XD.tipo_docu=? GROUP BY XD.indicador_servicio
DB_SELECT_DETALLE_BOLETA_PERIODO=SELECT XD.tipo_docu, XD.folio_dte, XD.indicador_servicio, DE.fec_emi_dte, DE.mont_tot_dte, DE.mnt_exen_dte FROM xmldte XD, dte_enc DE WHERE XD.codi_empr=DE.codi_empr AND XD.tipo_docu=DE.tipo_docu AND XD.folio_dte=DE.folio_dte AND (XD.tipo_docu=? OR XD.tipo_docu=?) AND DE.fec_emi_dte LIKE ? AND XD.codi_empr=? ORDER BY XD.tipo_docu ASC, XD.folio_dte ASC
DB_INSERT_LIBRO_BOLETAS=INSERT INTO libro_boleta (periodo, estado, xml, fecha_emision) VALUES (?,?,?,?)

#Consumo de folios 
DB_SELECT_FOLIO_ESTADO_RANGO=SELECT XD.folio_dte, XD.est_xdte FROM xmldte XD, dte_enc DE WHERE DE.codi_empr=XD.codi_empr AND DE.tipo_docu=XD.tipo_docu AND DE.folio_dte=XD.folio_dte AND XD.codi_empr=? AND XD.tipo_docu=? AND DE.fec_emi_dte >= ? AND DE.fec_emi_dte <= ? ORDER BY XD.folio_dte ASC
DB_SELECT_TOTALES_RANGO_CONSUMO=SELECT SUM(DE.mntneto_dte), SUM(DE.mnt_exen_dte), SUM(DE.mont_tot_dte), SUM(DE.iva_dte) FROM dte_enc DE, xmldte XD WHERE DE.codi_empr=XD.codi_empr AND DE.tipo_docu=XD.tipo_docu AND DE.folio_dte=XD.folio_dte AND XD.codi_empr=? AND XD.tipo_docu=? AND DE.fec_emi_dte >= ? AND DE.fec_emi_dte <= ?

#EnvioBoleta
DB_INSERT_ENVIO_BOLETA=INSERT INTO xmlenvioboleta (est_xed, coderr_xed, msg_xed, xml_xed, signed_xed, trackid_xed, codi_empr) VALUES (?,?,?,?,?,?,?)
DB_UPDATE_BOLETA_EMPAQUETADO=UPDATE xmldte SET est_xdte=est_xdte+?, num_envioboleta=? WHERE folio_dte=? AND tipo_docu=? AND (est_xdte&?)=0 AND codi_empr=?
DB_SELECT_ULTIMO_IDENVIOBOLETA_INSERTADO=SELECT CURRVAL('xmlenvioboleta_num_xed_seq') FROM xmlenvioboleta

#SUBIR ENVIO BOLETA AL SII
DB_SELECT_TOTAL_ENVIOS_BOLETA_PENDIENTES=SELECT count(*) FROM xmlenvioboleta WHERE (est_xed&?)=? AND codi_empr=?
DB_SELECT_XMLENVIOBOLETA_SII=SELECT signed_xed, num_xed FROM xmlenvioboleta WHERE (est_xed&?)=? AND codi_empr=?
DB_UPDATE_ENVIO_BOLETA=UPDATE xmlenvioboleta SET est_xed=est_xed+?, trackid_xed=?, msg_xed=? WHERE num_xed=? AND (est_xed&?)=0
DB_UPDATE_ESTADO_BOLETA_ENVIADO=UPDATE xmldte SET est_xdte=est_xdte+? WHERE num_envioboleta=? AND (est_xdte&?)=0

#SUBIR CONSUMO FOLIO AL SII
DB_SELECT_TOTAL_CONSUMO_FOLIO_PENDIENTES=SELECT count(*) FROM xmlconsumofolio WHERE (estado&?)=? AND codi_empr=?
DB_SELECT_XMLCONSUMOFOLIO_SII=SELECT xml_consumo, num_consumofolio FROM xmlconsumofolio WHERE (estado&?)=? AND codi_empr=?
DB_UPDATE_CONSUMO_FOLIO=UPDATE xmlconsumofolio SET estado=estado+?, trackid=?, msg_sii=? WHERE num_consumofolio=? AND (estado&?)=0


#Consumo de folio
DB_LOCK_TABLE_XMLCONSUMOFOLIO=LOCK TABLE xmlconsumofolio IN EXCLUSIVE MODE
DB_SELECT_ACTUAL_NUMERO_SECUENCIA=SELECT max(numero_secuencia) FROM xmlconsumofolio WHERE (estado&?)=0
DB_INSERT_CONSUMO_FOLIO=INSERT INTO xmlconsumofolio (estado, xml_consumo, numero_secuencia, codi_empr, fecha_emision) VALUES (?,?,?,?,?)

#Estados consumo folio
CO_ESTADO_CONSUMO_FOLIO_FIRMADO=1
CO_ESTADO_CONSUMO_FOLIO_ERROR=2
CO_ESTADO_CONSUMO_FOLIO_ENVIADO_SII=4
CO_ESTADO_CONSUMO_FOLIO_ACEPTADO_SII=8
CO_ESTADO_CONSUMO_FOLIO_ACEPTADO_REPAROS_SII=16
CO_ESTADO_CONSUMO_FOLIO_RECHAZADO_SII=32

#VARIABLES DEL SISTEMA
RUT_SII=60803000-K
#OFICINA_SII=S.I.I. - SANTIAGO ORIENTE

#Variables de Impresion
#Plataforma puede ser DOS o UNIX
#PLATAFORMA=DOS
#IMPRESORA_DTE=LaserJet-1300
#NRO_COPIAS_IMPRESION_DTE=1
#COMANDO_XPDF_PDFTOPS=/usr/bin/pdf2ps
#COMANDO_XPDF_PDFTOPS=D\:\\Facturacion_demoOpenDTE\\gs\\gs8.54\\lib\\pdf2ps.bat
#En caso de impresion en windows
#COLA_IMPRESION_DOS=print /d:lpt4

# Comandos de Impresion
HABILITAR_IMPRESION=N
IMPRESORA_POSTSCRIPT=N
#CMD_PRINT_ACROBAT=cmd.exe start /C "C\:\\Program Files\\Adobe\\Acrobat 7.0\\Reader\\AcroRd32.exe" /p /h 

#COMANDO PARA IMPRESION
COMANDO_IMPRESION=lpr


#Procesamiento de CAF
#ARCHIVO_TEMPORAL_LLAVE_CAF_PRIV=D:\\Facturacion_demoOpenDTE\\Archivos\\CAF\\Temp\\llave.priv
#ARCHIVO_TEMPORAL_LLAVE_CAF_PEM=D:\\Facturacion_demoOpenDTE\\Archivos\\CAF\\Temp\\llave.pem
#COMANDO_OPENSSL_CAF=D:\\GnuWin32\\bin\\openssl pkcs8 -in D:\\Facturacion_demoOpenDTE\\Archivos\\CAF\\Temp\\llave.priv -topk8 -nocrypt -out D:\\Facturacion_demoOpenDTE\\Archivos\\CAF\\Temp\\llave.pem
#ARCHIVO_TEMPORAL_LLAVE_CAF_PRIV=/tmp/llave.priv
#ARCHIVO_TEMPORAL_LLAVE_CAF_PEM=/tmp/llave.pem
#COMANDO_OPENSSL_CAF=/usr/bin/openssl pkcs8 -in /tmp/llave.priv -topk8 -nocrypt -out /tmp/llave.pem


#Variables de conexion a la base de datos
DB_DRIVER=org.postgresql.Driver
DB_URL=jdbc:postgresql://10.0.0.11:5432/opendte
DB_USER=opendte
DB_PASSWORD=root8831
URL_ARCHIVO_PDF_WS=http://portaldte.opendte.cl/dte/view_pdf.php?sUrlPdf=

# Esquemas
#DIR_ESQUEMAS_SII=D:\\Facturacion_demoOpenDTE\\esquemas\\
DIR_ESQUEMAS_SII=/opt/opendte/esquemas/


# Cuentas Email SII
FROM_SII_DTE_ACEPTADOS=siidte\@sii.cl
FROM_SII_DTE_ACEPTADOS_REPAROS=siidte_reparo\@sii.cl
FROM_SII_DTE_RECHAZADOS=siidte_error\@sii.cl

CO_ESTADO_DTE_POR_FIRMAR=0
CO_ESTADO_DTE_FIRMADO=1
CO_ESTADO_DTE_ERROR=2
CO_ESTADO_DTE_EMPAQUETADO=4
CO_ESTADO_DTE_ENVIADO_SII=8
CO_ESTADO_DTE_ACEPTADO_SII=16
CO_ESTADO_DTE_ACEPTADO_REPAROS_SII=32
CO_ESTADO_DTE_RECHAZADO_SII=64
CO_ESTADO_DTE_ENVIADO_CLIENTE=128
CO_ESTADO_DTE_ACEPTADO_CLIENTE=256


#Estado EnvioDTE
CO_ESTADO_ENVIO_POR_FIRMAR=0
CO_ESTADO_ENVIO_FIRMADO=1
CO_ESTADO_ENVIO_ENVIADO_SII=2
CO_ESTADO_ENVIO_VALIDADO_SII=4
CO_ESTADO_ENVIO_RECHAZADO_SII=8
CO_ESTADO_ENVIO_ACEPTADO_REPAROS_SII=12

#Estado XMLEnvioTerceros
CO_ESTADO_ENVIO_XMLTERCEROS_GENERADO=0
CO_ESTADO_ENVIO_XMLTERCEROS_ENVIADO=1
CO_ESTADO_ENVIO_XMLTERCEROS_RECIBIDA_RESPUESTA=2

#Estado DTEs recibidos
CO_DTE_TERCERO_RECIBIDO=0
CO_DTE_TERCEROS_VALIDADO=1

# Esquemas
#DIR_ESQUEMAS_SII=D:\\Facturacion_demoOpenDTE\\esquemas\\
ESQ_LIB_V_1.0=http://www.sii.cl/SiiDte LibroCV_v10.xsd
ESQ_ENVIODTE_V_1.0=http://www.sii.cl/SiiDte EnvioDTE_v10.xsd
FILE_ESQ_INT_V_1.0=RespuestaEnvioDTE_v10.xsd
FILE_ESQ_RESP_V_1.0=RespuestaEnvioDTE_v10.xsd
ESQ_LIBGUIA_V_1.0=http://www.sii.cl/SiiDte LibroGuia_v10.xsd
ESQ_DTE_V_1.0=DTE_v10.xsd
ESQ_BOLETA_V_1.1=EnvioBOLETA_v11.xsd
ESQ_BOLETA_V_1.0=EnvioBOLETA_v10.xsd
ESQ_CONSUMO_FOLIO_V_1.0=ConsumoFolio_v10.xsd

# Variables Libro Compra - Venta
CO_VERSION_LIBRO=1.0

# Variables SII
# Host de envio
HOST_ENVIO_AUTOMATICO_SII=palena.sii.cl
PATH_CGI_ENVIO_AUTOMATICO=/cgi_dte/UPL/DTEUpload
PROTOCOLO_ENVIO_AUTOMATICO_SII=https

# Host de solicitud de semilla
HOST_SOLICITUD_SEMILLA=palena.sii.cl
PATH_SOLICITUD_SEMILLA=/DTEWS/CrSeed.jws?WSDL
PROTOCOLO_SOLICITUD_SEMILLA=https

# Host Consulta DTE
HOST_CONSULTA_ESTADO_DTE=palena.sii.cl
PATH_CONSULTA_ESTADO_DTE=/DTEWS/QueryEstDte.jws?WSDL
PROTOCOLO_CONSULTA_ESTADO_DTE=https

# Host Consulta Envio
HOST_CONSULTA_ESTADO_ENVIO=palena.sii.cl
PATH_CONSULTA_ESTADO_ENVIO=/DTEWS/QueryEstUp.jws?WSDL
PROTOCOLO_CONSULTA_ESTADO_ENVIO=https

# Host de solicitud de TOKEN
HOST_SOLICITUD_TOKEN=palena.sii.cl
PATH_SOLICITUD_TOKEN=/DTEWS/GetTokenFromSeed.jws?WSDL
PROTOCOLO_SOLICITUD_TOKEN=https

# Glosas de recepcion
EST_RECEPCION_DOCUMENTO_0=DTE Recibido OK
EST_RECEPCION_DOCUMENTO_1=DTE Rechazado - Error de Firma
EST_RECEPCION_DOCUMENTO_2=DTE Rechazado - Error en RUT Emisor
EST_RECEPCION_DOCUMENTO_3=DTE Rechazado - Error en RUT Receptor
EST_RECEPCION_DOCUMENTO_4=DTE Rechazado - DTE Repetido
EST_RECEPCION_DOCUMENTO_99=DTE Rechazado - Otros

EST_RECEPCION_ENVIO_0=Envio Recibido Conforme
EST_RECEPCION_ENVIO_1=Envio Rechazado - Error de Esquema
EST_RECEPCION_ENVIO_2=Envio Rechazado - Error de Firma
EST_RECEPCION_ENVIO_3=Envio Rechazado - RUT Receptor No Corresponde
EST_RECEPCION_ENVIO_90=Envio Rechazado - Archivo Repetido
EST_RECEPCION_ENVIO_91=Envio Rechazado - Archivo Ilegible
EST_RECEPCION_ENVIO_99=Envio Rechazado - Otros

#ESTADOS CAF
CO_ESTADO_CAF_DISPONIBLE=1
CO_ESTADO_CAF_UTILIZADO=2

#INSERTAR CAF
DB_INSERT_CAF=INSERT INTO caf (tipo_docu, codi_empr, ini_num_caf, ter_num_caf, fol_disp_caf, xml_caf, privkey_fac, estado) VALUES (?,?,?,?,?,?,?,?)

# Procesa TXT
DB_LOCK_TABLE_CAF=LOCK TABLE caf IN EXCLUSIVE MODE
#DB_SELECT_FOLIO_DISPONIBLE=SELECT fol_disp_caf, ini_num_caf, ter_num_caf FROM caf WHERE tipo_docu=? AND codi_empr=? AND estado=? AND fol_disp_caf<=ter_num_caf
DB_SELECT_FOLIO_DISPONIBLE=SELECT min(fol_disp_caf), ini_num_caf, ter_num_caf FROM caf WHERE tipo_docu=? AND codi_empr=? AND estado=? AND fol_disp_caf<=ter_num_caf AND fol_disp_caf>=ini_num_caf GROUP BY ini_num_caf, ter_num_caf
DB_UPDATE_FOLIO_DISP=UPDATE caf SET fol_disp_caf=fol_disp_caf+1, estado=? WHERE tipo_docu=? AND codi_empr=? AND ini_num_caf=?
#DB_INSERT_XMLDTE=INSERT INTO xmldte (codi_empr, tipo_docu, folio_dte, num_xed, xml_codi_empr, xml_tipo_docu, xml_folio_dte, xml_xdte, signed_xdte, est_xdte, coderr_xdte, msg_xdte, rec_cli_xdte, folio_txt) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?)
DB_INSERT_XMLDTE=INSERT INTO xmldte (codi_empr, tipo_docu, folio_dte, num_xed, xml_codi_empr, xml_tipo_docu, xml_folio_dte, xml_xdte, signed_xdte, est_xdte, coderr_xdte, msg_xdte, rec_cli_xdte, folio_txt, xml_otros, indicador_servicio) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)
DB_SELECT_CODIGO_EMPRESA=SELECT codi_empr FROM empresa WHERE rut_empr=? AND dv_empr=?
DB_INSERT_DTE_ENC=INSERT INTO dte_enc (codi_empr, tipo_docu, folio_dte, fec_emi_dte, ind_nore_dte, tip_desp_dte, tt_prod_dte, ind_pserv_dte, ind_mntbruto_dte, fma_pago_dte, fec_canc_dte, per_desd_dte, per_hast_dte, med_pago_dte, codi_tepa_dte, dias_tepa_dte, fec_venc_dte, rut_emis_dte, digi_emis_dte, nom_emis_dte, giro_emis_dte, nom_sucu_dte, cod_sucu_dte, dir_orig_dte, com_orig_dte, ciud_orig_dte, cod_vend_dte, rut_mand_dte, dig_mand_dte, rut_rec_dte, dig_rec_dte, codi_rec_dte, nom_rec_dte, giro_rec_dte, cont_rec_dte, dir_rec_dte, com_rec_dte, ciud_rec_dte, dir_post_dte, com_post_dte, ciud_post_dte, rut_solfa_dte, dig_solfa_dte, pat_veh_dte, rut_tran_dte, dig_tran_dte, dir_dest_dte, com_dest_dte, ciud_dest_dte, mntneto_dte, mnt_exen_dte, mnt_base_dte, tasa_iva_dte, iva_dte, iva_propio_dte, iva_terc_dte, iva_nr_dte, cred_es65_dte, gar_enva_dte, mont_tot_dte, mont_nf_dte, subt_vese_dte, sald_ant_dte, valo_pag_dte, fech_carg, fech_impr, corr_envi, corr_rafo, nume_impr, corr_envi1, esta_docu, mens_envi, codi_ceco, feho_firm, vers_enca, feho_ted, firm_ted, mnsg_erro, usua_impr, vige_docu, codi_peri, esta_docu1) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)
DB_SELECT_CLIENTE=SELECT rut_cli FROM clientes WHERE rut_cli=?
DB_INSERT_CLIENTE=INSERT INTO clientes (rut_cli, codi_empr, dv_cli, emi_elec_cli, acrec_email) VALUES (?,?,?,?,?)
DB_SELECT_FOLIOTXT_XMLDTE=SELECT folio_txt FROM xmldte WHERE codi_empr=? AND tipo_docu=? AND folio_txt=?


#Insertar en LOG
DB_INSERT_LOG=INSERT INTO log (evento_log, det_log, fecha) VALUES (?,?,?)
DB_INSERT_LOG_EMPRESA=INSERT INTO log (evento_log, det_log, fecha, codi_empr) VALUES (?,?,?,?)

#Firma DTE
#DB_SELECT_CAF=SELECT CA.xml_caf, CA.privkey_fac FROM caf CA, empresa EM WHERE CA.estado=? AND CA.tipo_docu=? AND CA.codi_empr=EM.codi_empr AND EM.rut_empr=? AND CA.ini_num_caf<=? AND CA.ter_num_caf>=?
DB_SELECT_CAF=SELECT CA.xml_caf, CA.privkey_fac FROM caf CA, empresa EM WHERE CA.tipo_docu=? AND CA.codi_empr=EM.codi_empr AND EM.rut_empr=? AND CA.ini_num_caf<=? AND CA.ter_num_caf>=?
#DB_SELECT_DTE_POR_FIRMAR=SELECT XD.folio_dte, XD.tipo_docu, XD.xml_xdte FROM xmldte XD, empresa EM WHERE XD.est_xdte=? AND EM.codi_empr=XD.codi_empr AND EM.rut_empr=?
#DB_SELECT_DTE_POR_FIRMAR=SELECT XD.folio_dte, XD.tipo_docu, XD.xml_xdte, XD.xml_otros FROM xmldte XD, empresa EM WHERE XD.est_xdte=? AND EM.codi_empr=XD.codi_empr AND EM.rut_empr=?
DB_UPDATE_DTE_FIRMADO=UPDATE xmldte SET signed_xdte=?, est_xdte=est_xdte+?, path_pdf=?, path_pdf_cedible=? WHERE folio_dte=? AND tipo_docu=? AND (est_xdte&?)=0

#Firma envio desde BD
CO_MAXIMO_DTES_ENVIO=20
DB_LOCK_TABLE_XMLDTE=LOCK TABLE xmldte IN EXCLUSIVE MODE
DB_SELECT_TOTAL_DTES_EMPAQUETAR=SELECT count(*), tipo_docu FROM xmldte WHERE signed_xdte IS NOT NULL AND (est_xdte&?)=? AND codi_empr=? AND tipo_docu!=39 AND tipo_docu!=41 GROUP BY tipo_docu ORDER BY tipo_docu
# cometado por mauri DB_SELECT_DTES_EMPAQUETAR=SELECT tipo_docu, signed_xdte, folio_dte FROM xmldte WHERE signed_xdte IS NOT NULL AND (est_xdte&?)=? ORDER BY tipo_docu, folio_dte LIMIT ? OFFSET 0
DB_SELECT_DTES_EMPAQUETAR=SELECT tipo_docu, signed_xdte, folio_dte FROM xmldte WHERE signed_xdte IS NOT NULL AND (est_xdte&?)\=? AND codi_empr\=? AND tipo_docu\!\=39 AND tipo_docu\!\=41 ORDER BY tipo_docu, folio_dte LIMIT ? OFFSET 0 
DB_SELECT_ULTIMO_IDENVIO=SELECT max(num_xed) FROM xmlenviodte
DB_INSERT_ENVIO=INSERT INTO xmlenviodte (num_xed, est_xed, coderr_xed, msg_xed, xml_xed, signed_xed, trackid_xed, codi_empr) VALUES (?,?,?,?,?,?,?,?) 
DB_UPDATE_DTE_EMPAQUETADO=UPDATE xmldte SET est_xdte=est_xdte+?, num_xed=? WHERE folio_dte=? AND tipo_docu=? AND (est_xdte&?)=0 AND codi_empr=?

#FirmaEnvioBoleta
DB_SELECT_TOTAL_BOLETAS_EMPAQUETAR=SELECT count(*), tipo_docu FROM xmldte WHERE signed_xdte IS NOT NULL AND (est_xdte&?)=? AND codi_empr=? AND (tipo_docu=39 OR tipo_docu=41) GROUP BY tipo_docu ORDER BY tipo_docu
DB_SELECT_BOLETA_EMPAQUETAR=SELECT tipo_docu, signed_xdte, folio_dte FROM xmldte WHERE signed_xdte IS NOT NULL AND (est_xdte&?)=? AND codi_empr=? AND (tipo_docu=39 OR tipo_docu!=41) ORDER BY tipo_docu, folio_dte LIMIT ? OFFSET 0

#SUBIR ENVIO AL SII
DB_SELECT_TOTAL_ENVIOS_PENDIENTES=SELECT count(*) FROM xmlenviodte WHERE (est_xed&?)=? AND codi_empr=?
DB_SELECT_XMLENVIO_SII=SELECT signed_xed, num_xed FROM xmlenviodte WHERE (est_xed&?)=? AND codi_empr=?
DB_UPDATE_ENVIO=UPDATE xmlenviodte SET est_xed=est_xed+?, trackid_xed=?, msg_xed=? WHERE num_xed=? AND (est_xed&?)=0
DB_UPDATE_ESTADO_DTE_ENVIADO=UPDATE xmldte SET est_xdte=est_xdte+? WHERE num_xed=? AND (est_xdte&?)=0

#Estados respuesta envio SII
CO_ESTADO_UPLOADSII_0=Upload OK
CO_ESTADO_UPLOADSII_1=El Sender no tiene permiso para enviar
CO_ESTADO_UPLOADSII_2=Error en tama\u00EF\u00BF\u00BDo del archivo (muy grande o muy chico)
CO_ESTADO_UPLOADSII_3=Archivo cortado (tama\u00EF\u00BF\u00BDo <> al par\u00EF\u00BF\u00BDmetro size)
CO_ESTADO_UPLOADSII_5=No est\u00EF\u00BF\u00BD autenticado
CO_ESTADO_UPLOADSII_6=Empresa no autorizada a enviar archivos
CO_ESTADO_UPLOADSII_7=Esquema Invalido
CO_ESTADO_UPLOADSII_8=Firma del Documento
CO_ESTADO_UPLOADSII_9=Sistema Bloqueado
CO_ESTADO_UPLOADSII_Otro=Error Interno.

#Consulta estado envio en SII
DB_SELECT_ENVIO_PENDIENTE_ACTUALIZAR=SELECT num_xed, trackid_xed FROM xmlenviodte WHERE (est_xed&?)=0 AND trackid_xed IS NOT NULL AND codi_empr=?
DB_UPDATE_ENVIO_SII=UPDATE xmlenviodte SET est_xed=est_xed+? WHERE num_xed=? AND (est_xed&?)=0
DB_UPDATE_DTE_SII=UPDATE xmldte SET est_xdte=est_xdte+? WHERE num_xed=? AND (est_xdte&?)=0
DB_SELECT_DTE_ENVIO=SELECT DE.rut_rec_dte, DE.dig_rec_dte, DE.tipo_docu, DE.folio_dte, DE.fec_emi_dte, DE.mont_tot_dte FROM dte_enc DE, xmldte XD WHERE XD.codi_empr=DE.codi_empr AND XD.tipo_docu=DE.tipo_docu AND XD.folio_dte=DE.folio_dte AND XD.num_xed=?

#Envio a Clientes
DB_SELECT_DTE_ENVIAR_CLIENTES=SELECT XD.codi_empr, XD.tipo_docu, XD.folio_dte, XD.signed_xdte, DE.rut_rec_dte, DE.dig_rec_dte FROM xmldte XD, dte_enc DE WHERE XD.codi_empr=DE.codi_empr AND XD.tipo_docu=DE.tipo_docu AND XD.folio_dte=DE.folio_dte AND (XD.est_xdte&?)=? ORDER BY DE.folio_dte
DB_SELECT_CONTRIBUYENTE_ELECTRONICO=SELECT nrores_contr, fecres_contr, email_contr FROM contrib_elec WHERE rut_contr=?
DB_SELECT_CLIENTE_ENVIO=SELECT acrec_email, email_envio FROM clientes WHERE rut_cli=?
DB_SELECT_TOTAL_DTE_ENVIAR_CLIENTES=SELECT count(*), DE.rut_rec_dte, DE.dig_rec_dte FROM xmldte XD, dte_enc DE WHERE XD.codi_empr=DE.codi_empr AND XD.tipo_docu=DE.tipo_docu AND DE.tipo_docu!=39 AND DE.tipo_docu!=41 AND XD.folio_dte=DE.folio_dte AND (XD.est_xdte&?)=? AND XD.codi_empr=? GROUP BY DE.rut_rec_dte, DE.dig_rec_dte ORDER BY count(*) DESC, DE.rut_rec_dte
DB_SELECT_TOTAL_XML_CONTRIBUYENTE=SELECT count(*), XD.tipo_docu FROM xmldte XD, dte_enc DE WHERE XD.codi_empr=DE.codi_empr AND XD.tipo_docu=DE.tipo_docu AND DE.tipo_docu!=39 AND DE.tipo_docu!=41 AND XD.folio_dte=DE.folio_dte AND (XD.est_xdte&?)=? AND DE.rut_rec_dte=? AND DE.dig_rec_dte=? AND XD.codi_empr=? GROUP BY XD.tipo_docu ORDER BY count(*) DESC
DB_SELECT_XML_CONTRIBUYENTE=SELECT XD.signed_xdte, XD.codi_empr FROM xmldte XD, dte_enc DE WHERE XD.codi_empr=DE.codi_empr AND XD.tipo_docu=DE.tipo_docu AND XD.folio_dte=DE.folio_dte AND (XD.est_xdte&?)=? AND DE.rut_rec_dte=? AND DE.dig_rec_dte=? AND XD.codi_empr=?
DB_SELECT_ULTIMO_IDENVIO_TERCEROS=SELECT max(folio_envio) FROM xmlenvioterceros
DB_INSERT_XML_ENVIO_TERCEROS=INSERT INTO xmlenvioterceros (folio_envio, id_rdt, xml_xet, estado, codi_empr) VALUES (?,?,?,?,?)
DB_UPDATE_XML_ENVIO_TERCEROS=UPDATE xmlenvioterceros SET estado=estado+? WHERE folio_envio=? AND (estado&?)=?
DB_UPDATE_XMLDTE_FOLIO_TERCEROS=UPDATE xmldte SET folio_envio_terceros\=? WHERE codi_empr\=? AND tipo_docu\=? AND folio_dte\=? 
DB_UPDATE_XMLDTE_ENVIADO_TERCEROS=UPDATE xmldte SET est_xdte=est_xdte+? WHERE folio_envio_terceros=? AND (est_xdte&?)!=?
DB_SELECT_PDF_CLIENTE=SELECT XD.path_pdf, XD.codi_empr, XD.tipo_docu, XD.folio_dte, XD.path_pdf_cedible FROM xmldte XD, dte_enc DE WHERE XD.codi_empr=DE.codi_empr AND XD.tipo_docu=DE.tipo_docu AND XD.folio_dte=DE.folio_dte AND (XD.est_xdte&?)=? AND DE.rut_rec_dte=? AND DE.dig_rec_dte=? AND XD.codi_empr=?
DB_UPDATE_XMLDTE_ENVIADO_PDF=UPDATE xmldte SET est_xdte=est_xdte+? WHERE codi_empr=? AND tipo_docu=? AND folio_dte=? AND (est_xdte&?)!=?

#Firma de un Envio de DTE
DB_SELECT_ENVIO_POR_FIRMAR=SELECT XML_XED, NUM_XED FROM xmlenviodte WHERE EST_XED=?
DB_UPDATE_ENVIO_FIRMADO=UPDATE xmlenviodte SET SIGNED_XED=?, EST_XED=? WHERE NUM_XED=?

#ESTADOS LIBRO
CO_ESTADO_LIBRO_GENERADO=0
CO_ESTADO_LIBRO_ENVIADO_SII=1
CO_ESTADO_LIBRO_ACEPTADO_SII=2
CO_ESTADO_LIBRO_RECHAZADO_SII=4
CO_ESTADO_LIBRO_ACEPTADO_REPAROS_SII=8

#INSERTAR LIBRO
DB_INSERT_LIBRO=INSERT INTO lcv (codi_empr, clcv_rut_emisor, clcv_dv_emisor, clcv_per_trib, clcv_tip_oper, clcv_tip_lib, clcv_tip_env, clcv_num_seg, clcv_ver_lib, clcv_fol_not) VALUES (?,?,?,?,?,?,?,?,?,?)
DB_INSERT_LIBRO_RESSEG=INSERT INTO lcv_res_seg (clcv_correl, rlcv_tip_doc, rlcv_can_doc, rlcv_tot_ope, rlcv_tot_exc, rlcv_tot_mto, rlcv_tot_iva, rlcv_iva_fpl, rlcv_tot_ley) VALUES (?,?,?,?,?,?,?,?,?)
DB_INSERT_LIBRO_XML=INSERT INTO lcvxml (clcv_correl, xml_lcx, signed_lcv, est_lcx, coderr_lcx, msg_lcx) VALUES (?,?,?,?,?,?)
DB_SELECT_ID_ULTIMO_LIBRO=SELECT max(clcv_correl) FROM lcv
DB_SELECT_LIBRO_PERIODO_TIPO=SELECT clcv_rut_emisor, clcv_dv_emisor, clcv_per_trib, clcv_tip_oper, clcv_tip_lib, clcv_tip_env, clcv_num_seg FROM lcv WHERE clcv_rut_emisor=? AND clcv_dv_emisor=? AND clcv_per_trib=? AND clcv_tip_oper=? AND clcv_tip_lib=? AND clcv_tip_env=? AND clcv_num_seg=?
DB_SELECT_LIBRO_PERIODO_TIPO_SGMTONULL=SELECT clcv_rut_emisor, clcv_dv_emisor, clcv_per_trib, clcv_tip_oper, clcv_tip_lib, clcv_tip_env, clcv_num_seg FROM lcv WHERE clcv_rut_emisor=? AND clcv_dv_emisor=? AND clcv_per_trib=? AND clcv_tip_oper=? AND clcv_tip_lib=? AND clcv_tip_env=? AND clcv_num_seg is NULL

#INSERTAR LIBRO GUIA
DB_INSERT_LIBRO_GUIA=INSERT INTO lcv (codi_empr, clcv_rut_emisor, clcv_dv_emisor, clcv_per_trib, clcv_tip_oper, clcv_tip_lib, clcv_tip_env, clcv_num_seg, clcv_ver_lib, clcv_fol_not) VALUES (?,?,?,?,?,?,?,?,?,?)
DB_INSERT_LIBRO_GUIA_RESSEG=INSERT INTO lcv_res_seg (clcv_correl, rlcv_tip_doc, rlcv_can_doc, rlcv_tot_ope, rlcv_tot_exc, rlcv_tot_mto, rlcv_tot_iva, rlcv_iva_fpl, rlcv_tot_ley) VALUES (?,?,?,?,?,?,?,?,?)

#Enviar libro al SII
DB_SELECT_LIBRO_ENVIAR_SII=SELECT LX.cod_lcx, LX.signed_lcv FROM lcvxml LX, lcv LC WHERE (LX.est_lcx & ?)=? AND LC.clcv_correl=LX.clcv_correl AND LC.codi_empr=?
DB_UPDATE_LIBRO_ENVIADO_SII=UPDATE lcvxml SET est_lcx=est_lcx+?, trackid=? WHERE cod_lcx=? AND (est_lcx & ?) = 0
DB_UPDATE_ESTADO_ENVIO_LIBRO_SII=UPDATE lcvxml SET est_lcx=est_lcx+? WHERE cod_lcx=? AND (est_lcx & ?) = 0
DB_SELECT_ENVIO_LIBRO_PENDIENTE_ACTUALIZAR=SELECT LX.cod_lcx, LX.trackid FROM lcvxml LX, lcv LC WHERE (LX.est_lcx & ?)=0 AND LC.clcv_correl=LX.clcv_correl AND LC.codi_empr=?

#Actualizar envio desde el procesamiento de email
DB_UPDATE_ESTADO_ENVIO_TRACKID=UPDATE xmlenviodte SET est_xed=est_xed+?, glosa_sii=? WHERE trackid_xed=? AND (est_xed&?)=0
DB_SELECT_FOLIO_ENVIO_TRACKID=SELECT num_xed FROM xmlenviodte WHERE trackid_xed=?
DB_UPDATE_ESTADO_XMLDTE=UPDATE xmldte SET est_xdte=est_xdte+? WHERE num_xed=? AND (est_xdte&?)=0
DB_UPDATE_ESTADO_XMLDTE_RECHAZOREPARO=UPDATE xmldte SET est_xdte=est_xdte+? WHERE folio_dte=? AND tipo_docu=? AND (est_xdte&?)=0 AND codi_empr=?

#Recepcion de documentos
#Estados de envio recibido
CO_ENVIO_RECIBIDO_PENDIENTE=0
CO_ENVIO_RECIBIDO_PROCESADO=1
CO_ENVIO_RECIBIDO_ACEPTADO=2
CO_ENVIO_RECIBIDO_REPARADO=4
CO_ENVIO_RECIBIDO_RECHAZADO=8
CO_ENVIO_RECIBIDO_ANULADO=16
CO_ENVIO_RECIBIDO_RESPONDIDO=32
CO_ENVIO_RECIBIDO_RECHAZADO_FIRMA=64
CO_ENVIO_RECIBIDO_RECHAZADO_ESQUEMA=128

#ESTADO RESPUESTAS RECIBIDAS
CO_ESTADO_RESPUESTA_RECIBIDA=1
CO_ESTADO_RESPUESTA_VALIDADA=2

#PROCESAMIENTO EMAILS DESDE TERCEROS
DB_SELECT_EMISOR_ELECTRONICO=SELECT email_contr FROM contrib_elec WHERE rut_contr=?
DB_INSERT_ENVIO_RECEPCIONADO_EMPRESA=INSERT INTO envios_recibidos (rut_contr, xml_envr, est_envr, codi_empr) VALUES (?,?,?,?)
DB_INSERT_ENVIO_RECEPCIONADO=INSERT INTO envios_recibidos (rut_contr, xml_envr, est_envr, codi_empr) VALUES (?,?,?,?)

DB_SELECT_ULTIMO_INSERTADO_ENVIO_RECEPCIONADO=SELECT CURRVAL('envios_recibidos_correl_envr_seq') FROM envios_recibidos
DB_INSERT_DTE_RECEPCIONADO=INSERT INTO dte_recep (rut_rec, ndte_rec, correl_envr, codi_empr, tipo_docu, fec_dte_rec, gls_rec, monto_dte_rec, lin_det_rec, monto_lin_rec, est_dte_rec) VALUES (?,?,?,?,?,?,?,?,?,?,?)
DB_UPDATE_RESPUESTA_ENVIO_RECEPCIONADO=UPDATE envios_recibidos SET xml_resp_envr=?, est_envr=est_envr+? WHERE correl_envr=?
DB_INSERT_RESPUESTA_RECIBIDA=INSERT INTO respuestadtedesdeterceros (codi_empr, tipo_docu, folio_dte, est_rdt, xml_rdt) VALUES (?,?,?,?,?)
DB_UPDATE_ENVIO_ENVIADO=UPDATE xmlenvioterceros SET id_rdt=?, estado=estado+? WHERE folio_envio=? AND (estado&?)=0
DB_SELECT_ID_RESPUESTA_INSERTADA=SELECT CURRVAL('respuestadtedesdeterceros_id_rdt_seq') FROM respuestadtedesdeterceros
#multiempresa
DB_UPDATE_DTE_RECIBIDA_RESPUESTA=UPDATE xmldte SET est_xdte=est_xdte+? WHERE folio_dte=? AND tipo_docu=? AND (est_xdte&?)=0 AND codi_empr=?

#/**********************************************************************************************/
#EXPORTAR XML DE TERCEROS RECIBIDOS A DB DE ERP O SISTEMA DE FACTURACION
#ESTADO REGISTRO
EX_ESTADO_NO_EXPORTADO=0
EX_ESTADO_EXPORTADO=1

DB_UPDATE_XML_EXPORTADO=UPDATE envios_recibidos SET est_export=? WHERE correl_envr=?
DB_SELECT_XML_POR_EXPORTAR=SELECT correl_envr, xml_envr FROM envios_recibidos WHERE est_export=? AND codi_empr=?


DB_INSERT_DTE_TERCERO=INSERT INTO documentoscompras_temp(correl_doc, tipo_docu, fec_emi_doc, rut_rec_dte, dig_rec_dte, nom_rec_dte, dir_rec_dte, rut_emis_dte, digi_emis_dte, nom_emis_dte, mntneto_dte ,  mnt_exen_dte ,  tasa_iva_dte ,  iva_dte ,  giro_rec_dte ,  dir_orig_dte, com_rec_dte, ciud_rec_dte, tipo_prod_serv, mont_tot_dte, moti_nc_nd, tipo_doc_ref, fact_ref, doc_ref, com_orig_dte, ciud_orig_dte, giro_emis_dte, codi_empr) VALUES( nextval('documentoscompras_temp_correl_doc_seq'), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 'PRODUCTO', ?, ?, ?, ?, ?, ?, ?, ?, ?)
DB_INSERT_DTE_TERCERO_DET=INSERT INTO detalle_doc_compras_temp( num_lin_ddoc , codi_empr, tipo_docu, correl_doc , ind_exen_det, nom_item_det, desc_item_det, cant_ref_det, prec_ref_det, cant_item_det, prec_item_det, desc_porc_det,dcto_item_det,reca_porc_det,reca_item_det) VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)
DB_INSERT_DTE_TERCERO_DESC_GLOB=INSERT INTO desrec_glob_compra_temp(correl_doc, tmov_dr, desc_dr, tvalor_dr, valor_dr, index_dr) VALUES(?,?,?,?,?,?)
DB_SELECT_SEQUE_TERCERO=SELECT currval('documentoscompras_temp_correl_doc_seq') 


#RECIBOS DE MERCADERIAS
CO_ESTADO_ENVIO_RECIBO_MERCADERIAS_GENERADO=0
CO_ESTADO_ENVIO_RECIBO_MERCADERIAS_ENVIADO=1

CO_ESTADO_RECIBOS_MERCADERIAS_EMPAQUETADO=1


#DB_SELECT_RECEPTORES_RECIBOS_PENDIENTES=SELECT DISTINCT rut_rec FROM recibo_mercaderias WHERE estado=0
DB_SELECT_RECEPTORES_RECIBOS_PENDIENTES=SELECT DISTINCT rut_rec FROM recibo_mercaderias WHERE estado=0 AND codi_empr=?
DB_SELECT_RECIBOS_PENDIENTES=SELECT RM.rut_rec, RM.ndte_rec, RM.tipo_docu, RM.recinto, RM.rut_firma, DR.fec_dte_rec, DR.monto_dte_rec FROM recibo_mercaderias RM, dte_recep DR WHERE RM.estado=0 AND RM.rut_rec=? AND DR.rut_rec=RM.rut_rec AND DR.ndte_rec=RM.ndte_rec AND DR.tipo_docu=RM.tipo_docu AND RM.codi_empr=?
DB_INSERT_RECIBO_MERCADERIAS=INSERT INTO envio_recibo_mercaderias (rut_responde, rut_recibe, nombre_contacto, fono_contacto, email_contacto, xml_recibo, estado) VALUES (?,?,?,?,?,?,?)
DB_UPDATE_RECIBOS_MERCADERIAS=UPDATE recibo_mercaderias SET declaracion=?, fecha_firma_recibo=?, estado=?, id_envio_recibo_mercaderias=? WHERE estado=0 AND rut_rec=? AND ndte_rec=? AND tipo_docu=? AND codi_empr=?
DB_SELECT_ULTIMO_ENVIO_MERCADERIAS_INSERTADO=SELECT CURRVAL('envio_recibo_mercaderias_id_seq') FROM envio_recibo_mercaderias
DB_SELECT_EMAIL_RECEPTOR_RECIBO_MERCADERIAS=SELECT email_contr FROM contrib_elec WHERE rut_contr=?
DB_UPDATE_ESTADO_ENVIO=UPDATE envio_recibo_mercaderias SET estado=? WHERE id=?


#IMPRESION CON PLANTILLAS
DB_SELECT_PLANTILLA_PROPERTIES=SELECT ruta_pdf_papel, ruta_propiedades FROM parametros_impresion WHERE tipo_dt=? AND tipo_movimiento=? AND codi_empr=?
DB_SELECT_DT_PDF=SELECT desc_tipo_docu FROM dte_tipo WHERE tipo_docu=?

#CARGA CERTIFICADO DIGITAL 
DB_SELECT_CERTIFICADO_CLAVE_EMPRESA=SELECT path_certificado, clave_certificado FROM certificado WHERE rut_empresa=? AND dv_empresa=?


#OBTIENE UN DTE EN PARTICULAR PARA LA FIRMA
DB_SELECT_DTE_POR_FIRMAR_WS=SELECT XD.folio_dte, XD.tipo_docu, XD.xml_xdte, XD.xml_otros FROM xmldte XD, empresa EM WHERE XD.est_xdte=? AND EM.codi_empr=XD.codi_empr AND EM.rut_empr=? AND XD.tipo_docu=? AND XD.folio_dte=?
DB_SELECT_DTE_POR_FIRMAR=SELECT XD.folio_dte, XD.tipo_docu, XD.xml_xdte, XD.xml_otros FROM xmldte XD, empresa EM WHERE XD.est_xdte=? AND EM.codi_empr=XD.codi_empr AND EM.rut_empr=? AND XD.tipo_docu!=39 AND XD.tipo_docu!=41
#boletas
DB_SELECT_DTE_POR_FIRMAR_BOLETA=SELECT XD.folio_dte, XD.tipo_docu, XD.xml_xdte, XD.xml_otros FROM xmldte XD, empresa EM WHERE XD.est_xdte=? AND EM.codi_empr=XD.codi_empr AND EM.rut_empr=? AND (XD.tipo_docu=39 OR XD.tipo_docu=41)

#CONSULTA ESTADO DTE
DB_SELECT_ESTADO_DTE=SELECT XDTE.est_xdte FROM xmldte XDTE, empresa EMP WHERE EMP.rut_empr=? AND EMP.dv_empr=? AND EMP.codi_empr=XDTE.codi_empr AND XDTE.tipo_docu=? AND XDTE.folio_dte=?


#ACTUALIZACION ESTADO LIBRO
DB_UPDATE_ESTADO_LIBRO_TRACKID=UPDATE lcvxml SET est_lcx=est_lcx+? WHERE trackid=? AND (est_lcx & ?)=0




#Query que obtiene inicio y termino de un rango de caf (utilizada para cuando xml de entrada trae folio)
DB_SELECT_FOLIOS_CAF=SELECT ini_num_caf, ter_num_caf FROM caf WHERE tipo_docu=? AND codi_empr=? AND estado=? AND ?<=ter_num_caf AND ?>=ini_num_caf GROUP BY ini_num_caf, ter_num_caf


#Obtiene las empresas activas con sus valores
DB_SELECT_EMPRESAS_ACTIVAS=SELECT codi_empr, rut_empr, dv_empr, rs_empr, propiedades FROM empresa
DB_SELECT_EMPRESA_BY_RUT=SELECT codi_empr, rut_empr, dv_empr, rs_empr, propiedades FROM empresa WHERE rut_empr\=? AND dv_empr\=?

#Query usado por WS que inserta Merito Ejecutivo
DB_INSERT_RECIBO_MERCADERIAS_WS=INSERT INTO recibo_mercaderias (rut_rec, ndte_rec, tipo_docu, recinto, rut_firma) VALUES (?,?,?,?,?)

#Query usado por WS que Elimina DTE
DB_DELETE_DTE_WS=DELETE FROM xmldte WHERE codi_empr=? AND tipo_docu=? AND folio_dte=? AND (est_xdte=? OR est_xdte=?)
DB_DELETE_DETALLE_DTE_WS=DELETE FROM dte_det WHERE codi_empr=? AND tipo_docu=? AND folio_dte=?
DB_DELETE_ENCABEZADO_DTE_WS=DELETE FROM dte_enc WHERE codi_empr=? AND tipo_docu=? AND folio_dte=?

#Query usado por WS que Reenvía DTE
DB_SELECT_XML_PDF_DTE=SELECT XDTE.signed_xdte, XDTE.path_pdf FROM xmldte XDTE, empresa EMP WHERE EMP.rut_empr=? AND EMP.dv_empr=? AND EMP.codi_empr=XDTE.codi_empr AND XDTE.tipo_docu=? AND XDTE.folio_dte=?

